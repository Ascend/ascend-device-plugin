# Ascend Device Plugin.en
-   [Ascend Device Plugin](#ascend-device-plugin.md)
    -   [Description](#description.md)
    -   [Environment Dependencies](#environment-dependencies.md)
    -   [Building Ascend Device Plugin](#building-ascend-device-plugin.md)
    -   [Creating DaemonSet](#creating-daemonset.md)
    -   [Creating a Service Container](#creating-a-service-container.md)
-   [Directory Structure](#directory-structure.md)
-   [Version Updates](#version-updates.md)
<h2 id="ascend-device-plugin.md">Ascend Device Plugin</h2>

-   **[Description](#description.md)**  

-   **[Environment Dependencies](#environment-dependencies.md)**  

-   **[Building Ascend Device Plugin](#building-ascend-device-plugin.md)**  

-   **[Creating DaemonSet](#creating-daemonset.md)**  

-   **[Creating a Service Container](#creating-a-service-container.md)**  


<h2 id="description.md">Description</h2>

The device management plugin provides the following functions:

-   Device discovery: The number of discovered devices can be obtained from the Ascend device driver and reported to the Kubernetes system. Virtual devices generated by splitting physical devices can be detected. The device splitting must be done in advance.
-   Health check: The health status of Ascend devices can be detected. When a device is unhealthy, the device is reported to the Kubernetes system and is removed. The health status of a virtual device is determined by the physical device from which the virtual device is split.
-   Device allocation: Ascend devices can be allocated in the Kubernetes system. 

<h2 id="environment-dependencies.md">Environment Dependencies</h2>

**Table  1**  Environment Dependencies

<a name="en-us_topic_0252788324_table171211952105718"></a>
<table><thead align="left"><tr id="en-us_topic_0269670261_en-us_topic_0252788324_row51223524573"><th class="cellrowborder" valign="top" width="48%" id="mcps1.2.3.1.1"><p id="en-us_topic_0269670261_en-us_topic_0252788324_p15122175218576"><a name="en-us_topic_0269670261_en-us_topic_0252788324_p15122175218576"></a><a name="en-us_topic_0269670261_en-us_topic_0252788324_p15122175218576"></a>Check Item</p>
</th>
<th class="cellrowborder" valign="top" width="52%" id="mcps1.2.3.1.2"><p id="en-us_topic_0269670261_en-us_topic_0252788324_p1712211526578"><a name="en-us_topic_0269670261_en-us_topic_0252788324_p1712211526578"></a><a name="en-us_topic_0269670261_en-us_topic_0252788324_p1712211526578"></a>Requirement</p>
</th>
</tr>
</thead>
<tbody><tr id="en-us_topic_0269670261_row1985835314489"><td class="cellrowborder" valign="top" width="48%" headers="mcps1.2.3.1.1 "><p id="en-us_topic_0269670261_p1925915619412"><a name="en-us_topic_0269670261_p1925915619412"></a><a name="en-us_topic_0269670261_p1925915619412"></a>dos2unix</p>
</td>
<td class="cellrowborder" valign="top" width="52%" headers="mcps1.2.3.1.2 "><p id="en-us_topic_0269670261_p1025985634111"><a name="en-us_topic_0269670261_p1025985634111"></a><a name="en-us_topic_0269670261_p1025985634111"></a>Run the <strong id="b9360144817168"><a name="b9360144817168"></a><a name="b9360144817168"></a>dos2unix --version</strong> command to check that the software has been installed. There is no requirement on the version.</p>
</td>
</tr>
<tr id="en-us_topic_0269670261_row16906451114817"><td class="cellrowborder" valign="top" width="48%" headers="mcps1.2.3.1.1 "><p id="en-us_topic_0269670261_p212295212575"><a name="en-us_topic_0269670261_p212295212575"></a><a name="en-us_topic_0269670261_p212295212575"></a>Driver version of the RUN package</p>
</td>
<td class="cellrowborder" valign="top" width="52%" headers="mcps1.2.3.1.2 "><p id="en-us_topic_0269670261_p31997012111"><a name="en-us_topic_0269670261_p31997012111"></a><a name="en-us_topic_0269670261_p31997012111"></a>Go to the directory of the driver (for example, <strong id="b950512535169"><a name="b950512535169"></a><a name="b950512535169"></a>/usr/local/Ascend/driver</strong>) and run the <strong id="b155111953101616"><a name="b155111953101616"></a><a name="b155111953101616"></a>cat version.info</strong> command to confirm that the driver version is 1.73 or later.</p>
</td>
</tr>
<tr id="en-us_topic_0269670261_row12226135012483"><td class="cellrowborder" valign="top" width="48%" headers="mcps1.2.3.1.1 "><p id="en-us_topic_0269670261_p3124195265717"><a name="en-us_topic_0269670261_p3124195265717"></a><a name="en-us_topic_0269670261_p3124195265717"></a>Go language environment</p>
</td>
<td class="cellrowborder" valign="top" width="52%" headers="mcps1.2.3.1.2 "><p id="en-us_topic_0269670261_p012435218578"><a name="en-us_topic_0269670261_p012435218578"></a><a name="en-us_topic_0269670261_p012435218578"></a>Run the <strong id="b13444656111615"><a name="b13444656111615"></a><a name="b13444656111615"></a>go version</strong> command to confirm that the version is 1.14.3 or later.</p>
</td>
</tr>
<tr id="en-us_topic_0269670261_row05615595485"><td class="cellrowborder" valign="top" width="48%" headers="mcps1.2.3.1.1 "><p id="en-us_topic_0269670261_p2124252115719"><a name="en-us_topic_0269670261_p2124252115719"></a><a name="en-us_topic_0269670261_p2124252115719"></a>gcc version</p>
</td>
<td class="cellrowborder" valign="top" width="52%" headers="mcps1.2.3.1.2 "><p id="en-us_topic_0269670261_p512445215576"><a name="en-us_topic_0269670261_p512445215576"></a><a name="en-us_topic_0269670261_p512445215576"></a>Run the <strong id="b254345881615"><a name="b254345881615"></a><a name="b254345881615"></a>gcc --version</strong> command to confirm that the version is 7.3.0 or later.</p>
</td>
</tr>
<tr id="en-us_topic_0269670261_row11826547124816"><td class="cellrowborder" valign="top" width="48%" headers="mcps1.2.3.1.1 "><p id="en-us_topic_0269670261_p151241522577"><a name="en-us_topic_0269670261_p151241522577"></a><a name="en-us_topic_0269670261_p151241522577"></a>Kubernetes version</p>
</td>
<td class="cellrowborder" valign="top" width="52%" headers="mcps1.2.3.1.2 "><p id="en-us_topic_0269670261_p89141115124714"><a name="en-us_topic_0269670261_p89141115124714"></a><a name="en-us_topic_0269670261_p89141115124714"></a>1.17.<em id="i19261912181713"><a name="i19261912181713"></a><a name="i19261912181713"></a>x</em>. Select the latest bugfix version.</p>
<p id="en-us_topic_0269670261_p1124115285720"><a name="en-us_topic_0269670261_p1124115285720"></a><a name="en-us_topic_0269670261_p1124115285720"></a>You can run the <strong id="b10594172511175"><a name="b10594172511175"></a><a name="b10594172511175"></a>kubectl version</strong> command to view the version.</p>
</td>
</tr>
<tr id="en-us_topic_0269670261_en-us_topic_0252788324_row11244529577"><td class="cellrowborder" valign="top" width="48%" headers="mcps1.2.3.1.1 "><p id="en-us_topic_0269670261_en-us_topic_0252788324_p16191917113619"><a name="en-us_topic_0269670261_en-us_topic_0252788324_p16191917113619"></a><a name="en-us_topic_0269670261_en-us_topic_0252788324_p16191917113619"></a>Docker environment</p>
</td>
<td class="cellrowborder" valign="top" width="52%" headers="mcps1.2.3.1.2 "><p id="en-us_topic_0269670261_en-us_topic_0252788324_p461711733616"><a name="en-us_topic_0269670261_en-us_topic_0252788324_p461711733616"></a><a name="en-us_topic_0269670261_en-us_topic_0252788324_p461711733616"></a>Run the <strong id="b18504438161717"><a name="b18504438161717"></a><a name="b18504438161717"></a>docker info</strong> command to confirm that Docker has been installed.</p>
</td>
</tr>
<tr id="en-us_topic_0269670261_row34271613113113"><td class="cellrowborder" valign="top" width="48%" headers="mcps1.2.3.1.1 "><p id="en-us_topic_0269670261_p1942971303117"><a name="en-us_topic_0269670261_p1942971303117"></a><a name="en-us_topic_0269670261_p1942971303117"></a>root user permission</p>
</td>
<td class="cellrowborder" valign="top" width="52%" headers="mcps1.2.3.1.2 "><p id="en-us_topic_0269670261_p8429113133117"><a name="en-us_topic_0269670261_p8429113133117"></a><a name="en-us_topic_0269670261_p8429113133117"></a>Check that the root user permission of the BMS is available.</p>
</td>
</tr>
</tbody>
</table>

<h2 id="building-ascend-device-plugin.md">Building Ascend Device Plugin</h2>

## Procedure<a name="section1719544174917"></a>

1.  Run the following commands to configure the environment variables:

    **export GO111MODULE=on**

    **export GOPROXY=**_Proxy address_

    **export GONOSUMDB=\\\***

    >![](figures/icon-note.gif) **NOTE:** 
    >Use the actual GOPROXY proxy address. You can run the  **go mod download**  command in the  **ascend-device-plugin**  directory to check the address. If no error information is displayed, the proxy is set successfully.

2.  \(Optional\) Go to the  **ascend-device-plugin**  directory and run the following command to modify the YAML file as required:
    -   Common YAML file

        **ascendplugin-910.yaml**

    -   YAML file of MindX DL

        **vim ascendplugin-volcano.yaml**

        ```
        ......      
              containers: 
              - image: ascend-k8sdeviceplugin:v2.0.2   # Image name and version
                name: device-plugin-01 
                resources: 
                  requests: 
                    memory: 500Mi 
                    cpu: 500m 
                  limits: 
                    memory: 500Mi 
                    cpu: 500m 
                command: [ "/bin/bash", "-c", "--"] 
                args: [ "ascendplugin  -useAscendDocker=true 
                        -volcanoType=true
                        -logFile=/var/log/mindx-dl/devicePlugin/devicePlugin.log  
                        -logLevel=0" ]  
        ......
        ```


3.  Set the  **useAscendDocker**  parameter.
    -   If Ascend Docker Runtime has been installed, set  **useAscendDocker**  to  **true**. This is the default scenario and is recommended.
    -   If Ascend Docker Runtime has not been installed, set  **useAscendDocker**  to  **false**.
    -   If CPU binding has been enabled, set  **useAscendDocker**  to  **false**  no matter whether Ascend Docker Runtime has been installed.

4.  Run the following commands to go to the build directory and execute the build script. The binary device-plugin, YAML, and Dockerfile files are generated in the  **output**  directory.

    **cd **_/home/test/_**ascend-device-plugin/build/**

    **chmod +x build.sh**

    **./build.sh**

5.  Run the following command to view the generated software package:

    **ll **_/home/test/_**ascend-device-plugin/output**

    ```
    drwxr-xr-x 2 root root     4096 Jun  8 18:42 ./ 
    drwxr-xr-x 9 root root     4096 Jun  8 17:12 ../ 
    -r-x------. 1 root root 31927176 Jul 26 14:12 device-plugin 
    -r--------. 1 root root     2081 Jul 26 14:12 device-plugin-310-v2.0.2.yaml 
    -r--------. 1 root root     2202 Jul 26 14:12 device-plugin-710-v2.0.2.yaml 
    -r--------. 1 root root     1935 Jul 26 14:12 device-plugin-910-v2.0.2.yaml 
    -r--------. 1 root root     3070 Jul 26 14:12 device-plugin-volcano-v2.0.2.yaml 
    -r--------. 1 root root      469 Jul 26 14:12 Dockerfile
    ```

    >![](figures/icon-note.gif) **NOTE:** 
    >The  **ascendplugin-910.yaml**  file in the  **ascend-device-plugin**  directory corresponds to the  **device-plugin-910-v2.0.2.yaml**  file in the  **ascend-device-plugin/output/**  directory and is used to update the version number.

6.  Run the following command to view the Dockerfile. You can modify the Dockerfile as required.

    **vi** _/home/test/_**ascend-device-plugin/Dockerfile**

    ```
    # Select the base image as required. You can run the docker images command to query the base image.
    FROM ubuntu:18.04 as build 
     
    RUN useradd -d /home/HwHiAiUser -u 1000 -m -s /usr/sbin/nologin HwHiAiUser 
    # Specify whether to use Ascend Docker. The default value is true. Change it to false.
    ENV USE_ASCEND_DOCKER true 
     
    ENV LD_LIBRARY_PATH  /usr/local/Ascend/driver/lib64/driver:/usr/local/Ascend/driver/lib64/common 
     
    ENV LD_LIBRARY_PATH $LD_LIBRARY_PATH:/usr/local/Ascend/driver/lib64/ 
    # Ensure that the device-plugin binary file exists for copying.
    COPY ./output/device-plugin /usr/local/bin/ 
     
    RUN chmod 550 /usr/local/bin/device-plugin &&\ 
    echo 'umask 027' >> /etc/profile &&\ 
    echo 'source /etc/profile' >> ~/.bashrc
    ```


<h2 id="creating-daemonset.md">Creating DaemonSet</h2>

## Procedure<a name="en-us_topic_0269670254_section2036324211563"></a>

>![](figures/icon-note.gif) **NOTE:** 
>The following operations use the ARM platform as an example to describe how to build and distribute images.

1.  Obtain the Ascend Device Plugin software package. If the software package is compiled by yourself, skip this step.
    1.  Log in to  [MindX DL](https://support.huawei.com/enterprise/zh/ascend-computing/mindx-pid-252501207/software).
    2.  Select the desired version and click  **Download**  next to the software package to obtain the software package and digital signature file.
    3.  After the download is complete, verify the integrity of the software package.

2.  Upload the software package to any directory \(for example,  **/home/ascend-device-plugin**\) on the server and decompress it.
3.  Go to the directory where the package is decompressed and run the following command to build the Ascend Device Plugin image.

    ```
    docker build -t ascend-k8sdeviceplugin:v2.0.2 .
    ```

    If "Successfully built xxx" is displayed, the image is successfully created. Do not omit  **.**  at the end of the command. The dot \(.\) indicates the current directory.

    Run the  **docker images**  command. You can find the image whose name is  **ascend-k8sdeviceplugin**  and tag is  **v2.0.2**.

4.  Run the following command to package and compress the compiled image for transmission between servers:

    >![](figures/icon-note.gif) **NOTE:** 
    >_\{arch\}_  indicates the system architecture. Images of different architectures cannot be shared.

    ```
    docker save -o ascend-k8sdeviceplugin:v2.0.2 | gzip > Ascend-K8sDevicePlugin-v2.0.2-{arch}-Docker.tar.gz
    ```

    Alternatively, run the following command to package the image \(the image will not be compressed\):

    ```
    docker save -o Ascend-K8sDevicePlugin-v2.0.2-{arch}-Docker.tar ascend-k8sdeviceplugin:v2.0.2
    ```

5.  \(Optional\) In cluster scenarios, distribute the packaged image \(for example, under  **/home/ascend-device-plugin/**\) to compute nodes with Ascend AI Processors.

    ```
    cd /home/ascend-device-plugin
    scp Ascend-K8sDevicePlugin-v2.0.2-{arch}-Docker.tar.gz root@{node IP address}:/home/ascend-device-plugin
    ```

6.  Run the following command to download the image. The compressed image file is used as an example. If the image file is not compressed, you need to change the file name.
    -   ARM

        ```
        docker load -i Ascend-K8sDevicePlugin-v2.0.2-arm64-Docker.tar.gz
        ```

    -   x86

        ```
        docker load -i Ascend-K8sDevicePlugin-v2.0.2-amd64-Docker.tar.gz
        ```

7.  Run the following command to label the node with Ascend 910, Ascend 310, or Ascend 710:

    ```
    kubectl label nodes localhost.localdomain accelerator=huawei-Ascend910
    ```

    **localhost.localdomain**  is the name of the node with Ascend 910, Ascend 310, or Ascend 710. You can run the  **kubectl get node**  command to view the node name.

    The label name must be the same as the  **nodeSelector**  label name in the YAML file in the software package.


8.  Go to the  **ascend-device-plugin/output**  directory and run the following command to deploy DaemonSet:

    -   On the  Ascend 310 AI Processor  node:

        ```
        kubectl apply -f device-plugin-310-v2.0.2.yaml
        ```

    -   On the  Ascend 910 AI Processor  node, working with Volcano:

        ```
        kubectl apply -f device-plugin-volcano-v2.0.2.yaml
        ```

    -   On the  Ascend 710 AI Processor  node:

        ```
        kubectl apply -f device-plugin-710-v2.0.2.yaml
        ```
    
    - On the  Ascend 910 AI Processor  node, where Ascend Device Plugin works independently and does not collaborate with Volcano:
    
      ```
      kubectl apply -f device-plugin-910-v2.0.2.yaml
      ```
    
    To view the node deployment information, you need to wait for several minutes after the deployment is complete. For details about the parameters in the YAML file, see  [Table 1](#table1286935610129).
    
    **Table  1**  Ascend Device Plugin startup parameters
    
    <a name="table1286935610129"></a>
    
    <table><thead align="left"><tr id="en-us_topic_0000001125023832_row78661456101218"><th class="cellrowborder" valign="top" width="25%" id="mcps1.2.5.1.1"><p id="en-us_topic_0000001125023832_p14866185661214"><a name="en-us_topic_0000001125023832_p14866185661214"></a><a name="en-us_topic_0000001125023832_p14866185661214"></a>Parameter</p>
    </th>
    <th class="cellrowborder" valign="top" width="15%" id="mcps1.2.5.1.2"><p id="en-us_topic_0000001125023832_p58661456151210"><a name="en-us_topic_0000001125023832_p58661456151210"></a><a name="en-us_topic_0000001125023832_p58661456151210"></a>Type</p>
    </th>
    <th class="cellrowborder" valign="top" width="15%" id="mcps1.2.5.1.3"><p id="en-us_topic_0000001125023832_p3866185610124"><a name="en-us_topic_0000001125023832_p3866185610124"></a><a name="en-us_topic_0000001125023832_p3866185610124"></a>Default Value</p>
    </th>
    <th class="cellrowborder" valign="top" width="45%" id="mcps1.2.5.1.4"><p id="en-us_topic_0000001125023832_p2866556171219"><a name="en-us_topic_0000001125023832_p2866556171219"></a><a name="en-us_topic_0000001125023832_p2866556171219"></a>Description</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="en-us_topic_0000001125023832_row178677563121"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.2.5.1.1 "><p id="en-us_topic_0000001125023832_p186620564122"><a name="en-us_topic_0000001125023832_p186620564122"></a><a name="en-us_topic_0000001125023832_p186620564122"></a>-mode</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.2 "><p id="en-us_topic_0000001125023832_p18666563129"><a name="en-us_topic_0000001125023832_p18666563129"></a><a name="en-us_topic_0000001125023832_p18666563129"></a>string</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.3 "><p id="en-us_topic_0000001125023832_p686645671212"><a name="en-us_topic_0000001125023832_p686645671212"></a><a name="en-us_topic_0000001125023832_p686645671212"></a>None</p>
    </td>
    <td class="cellrowborder" valign="top" width="45%" headers="mcps1.2.5.1.4 "><p id="en-us_topic_0000001125023832_p10866156121215"><a name="en-us_topic_0000001125023832_p10866156121215"></a><a name="en-us_topic_0000001125023832_p10866156121215"></a>Running mode of Ascend Device Plugin. If this parameter is not specified, the running mode is automatically specified based on the NPU type.</p>
    <a name="en-us_topic_0000001125023832_ul14191351239"></a><a name="en-us_topic_0000001125023832_ul14191351239"></a><ul id="en-us_topic_0000001125023832_ul14191351239"><li><strong id="en-us_topic_0000001125023832_b985785715363"><a name="en-us_topic_0000001125023832_b985785715363"></a><a name="en-us_topic_0000001125023832_b985785715363"></a>ascend310</strong>: running in <span id="en-us_topic_0000001125023832_ph9702132613260"><a name="en-us_topic_0000001125023832_ph9702132613260"></a><a name="en-us_topic_0000001125023832_ph9702132613260"></a>Ascend 310 AI Processor</span> mode</li><li><strong id="en-us_topic_0000001125023832_b1067543353717"><a name="en-us_topic_0000001125023832_b1067543353717"></a><a name="en-us_topic_0000001125023832_b1067543353717"></a>ascend710</strong>: running in Ascend 710 AI Processor mode</li><li><strong id="en-us_topic_0000001125023832_b18167337103710"><a name="en-us_topic_0000001125023832_b18167337103710"></a><a name="en-us_topic_0000001125023832_b18167337103710"></a>ascend910</strong>: running in <span id="en-us_topic_0000001125023832_ph10107162619264"><a name="en-us_topic_0000001125023832_ph10107162619264"></a><a name="en-us_topic_0000001125023832_ph10107162619264"></a>Ascend 910 AI Processor</span> mode</li></ul>
    </td>
    </tr>
    <tr id="en-us_topic_0000001125023832_row48671256151214"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.2.5.1.1 "><p id="en-us_topic_0000001125023832_p12867145618121"><a name="en-us_topic_0000001125023832_p12867145618121"></a><a name="en-us_topic_0000001125023832_p12867145618121"></a>-fdFlag</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.2 "><p id="en-us_topic_0000001125023832_p17867195661211"><a name="en-us_topic_0000001125023832_p17867195661211"></a><a name="en-us_topic_0000001125023832_p17867195661211"></a>bool</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.3 "><p id="en-us_topic_0000001125023832_p2867856131218"><a name="en-us_topic_0000001125023832_p2867856131218"></a><a name="en-us_topic_0000001125023832_p2867856131218"></a>false</p>
    </td>
    <td class="cellrowborder" valign="top" width="45%" headers="mcps1.2.5.1.4 "><p id="en-us_topic_0000001125023832_p12867956131212"><a name="en-us_topic_0000001125023832_p12867956131212"></a><a name="en-us_topic_0000001125023832_p12867956131212"></a>Edge scenario flag, indicating whether to manage devices with <span id="en-us_topic_0000001125023832_ph147289368387"><a name="en-us_topic_0000001125023832_ph147289368387"></a><a name="en-us_topic_0000001125023832_ph147289368387"></a>FusionDirector</span></p>
    </td>
    </tr>
    <tr id="en-us_topic_0000001125023832_row198671564128"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.2.5.1.1 "><p id="en-us_topic_0000001125023832_p1486717563122"><a name="en-us_topic_0000001125023832_p1486717563122"></a><a name="en-us_topic_0000001125023832_p1486717563122"></a>-useAscendDocker</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.2 "><p id="en-us_topic_0000001125023832_p5867856161210"><a name="en-us_topic_0000001125023832_p5867856161210"></a><a name="en-us_topic_0000001125023832_p5867856161210"></a>bool</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.3 "><p id="en-us_topic_0000001125023832_p78671956171212"><a name="en-us_topic_0000001125023832_p78671956171212"></a><a name="en-us_topic_0000001125023832_p78671956171212"></a>true</p>
    </td>
    <td class="cellrowborder" valign="top" width="45%" headers="mcps1.2.5.1.4 "><p id="en-us_topic_0000001125023832_p8867856151215"><a name="en-us_topic_0000001125023832_p8867856151215"></a><a name="en-us_topic_0000001125023832_p8867856151215"></a>Whether to use Ascend Docker Runtime</p>
    <div class="note" id="en-us_topic_0000001125023832_note58972114252"><a name="en-us_topic_0000001125023832_note58972114252"></a><a name="en-us_topic_0000001125023832_note58972114252"></a><span class="notetitle"> NOTE: </span><div class="notebody"><p id="en-us_topic_0000001125023832_p20899219253"><a name="en-us_topic_0000001125023832_p20899219253"></a><a name="en-us_topic_0000001125023832_p20899219253"></a>If CPU binding has been enabled, set <strong id="en-us_topic_0000001125023832_b95901052487"><a name="en-us_topic_0000001125023832_b95901052487"></a><a name="en-us_topic_0000001125023832_b95901052487"></a>useAscendDocker</strong> to <strong id="en-us_topic_0000001125023832_b14596205124817"><a name="en-us_topic_0000001125023832_b14596205124817"></a><a name="en-us_topic_0000001125023832_b14596205124817"></a>false</strong> no matter whether Ascend Docker Runtime is used.</p>
    </div></div>
    </td>
    </tr>
    <tr id="en-us_topic_0000001125023832_row13867205691219"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.2.5.1.1 "><p id="en-us_topic_0000001125023832_p1086715563123"><a name="en-us_topic_0000001125023832_p1086715563123"></a><a name="en-us_topic_0000001125023832_p1086715563123"></a>-volcanoType</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.2 "><p id="en-us_topic_0000001125023832_p2867556181217"><a name="en-us_topic_0000001125023832_p2867556181217"></a><a name="en-us_topic_0000001125023832_p2867556181217"></a>bool</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.3 "><p id="en-us_topic_0000001125023832_p138676568125"><a name="en-us_topic_0000001125023832_p138676568125"></a><a name="en-us_topic_0000001125023832_p138676568125"></a>false</p>
    </td>
    <td class="cellrowborder" valign="top" width="45%" headers="mcps1.2.5.1.4 "><p id="en-us_topic_0000001125023832_p1867145614122"><a name="en-us_topic_0000001125023832_p1867145614122"></a><a name="en-us_topic_0000001125023832_p1867145614122"></a>Whether to use Volcano for scheduling</p>
    </td>
    </tr>
    <tr id="en-us_topic_0000001125023832_row188681056111220"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.2.5.1.1 "><p id="en-us_topic_0000001125023832_p1486795641210"><a name="en-us_topic_0000001125023832_p1486795641210"></a><a name="en-us_topic_0000001125023832_p1486795641210"></a>-version</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.2 "><p id="en-us_topic_0000001125023832_p58671756201215"><a name="en-us_topic_0000001125023832_p58671756201215"></a><a name="en-us_topic_0000001125023832_p58671756201215"></a>bool</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.3 "><p id="en-us_topic_0000001125023832_p15868125621216"><a name="en-us_topic_0000001125023832_p15868125621216"></a><a name="en-us_topic_0000001125023832_p15868125621216"></a>false</p>
    </td>
    <td class="cellrowborder" valign="top" width="45%" headers="mcps1.2.5.1.4 "><p id="en-us_topic_0000001125023832_p17868135615124"><a name="en-us_topic_0000001125023832_p17868135615124"></a><a name="en-us_topic_0000001125023832_p17868135615124"></a>Version of Ascend Device Plugin</p>
    </td>
    </tr>
    <tr id="en-us_topic_0000001125023832_row11868756151216"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.2.5.1.1 "><p id="en-us_topic_0000001125023832_p8868135631213"><a name="en-us_topic_0000001125023832_p8868135631213"></a><a name="en-us_topic_0000001125023832_p8868135631213"></a>-edgeLogFile</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.2 "><p id="en-us_topic_0000001125023832_p1868155620126"><a name="en-us_topic_0000001125023832_p1868155620126"></a><a name="en-us_topic_0000001125023832_p1868155620126"></a>string</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.3 "><p id="en-us_topic_0000001125023832_p18868145616126"><a name="en-us_topic_0000001125023832_p18868145616126"></a><a name="en-us_topic_0000001125023832_p18868145616126"></a>/var/alog/AtlasEdge_log/devicePlugin.log</p>
    </td>
    <td class="cellrowborder" valign="top" width="45%" headers="mcps1.2.5.1.4 "><p id="en-us_topic_0000001125023832_p15868145614121"><a name="en-us_topic_0000001125023832_p15868145614121"></a><a name="en-us_topic_0000001125023832_p15868145614121"></a>Log path in the edge scenario</p>
    </td>
    </tr>
    <tr id="en-us_topic_0000001125023832_row178281038145918"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.2.5.1.1 "><p id="en-us_topic_0000001125023832_p716681713714"><a name="en-us_topic_0000001125023832_p716681713714"></a><a name="en-us_topic_0000001125023832_p716681713714"></a>-logLevel</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.2 "><p id="en-us_topic_0000001125023832_p116631743711"><a name="en-us_topic_0000001125023832_p116631743711"></a><a name="en-us_topic_0000001125023832_p116631743711"></a>int</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.3 "><p id="en-us_topic_0000001125023832_p10166121714371"><a name="en-us_topic_0000001125023832_p10166121714371"></a><a name="en-us_topic_0000001125023832_p10166121714371"></a>0</p>
    </td>
    <td class="cellrowborder" valign="top" width="45%" headers="mcps1.2.5.1.4 "><p id="en-us_topic_0000001125023832_p7166161783714"><a name="en-us_topic_0000001125023832_p7166161783714"></a><a name="en-us_topic_0000001125023832_p7166161783714"></a>Level of a log</p>
    <a name="en-us_topic_0000001125023832_ul086611015481"></a><a name="en-us_topic_0000001125023832_ul086611015481"></a><ul id="en-us_topic_0000001125023832_ul086611015481"><li><strong id="en-us_topic_0000001125023832_b577174975016"><a name="en-us_topic_0000001125023832_b577174975016"></a><a name="en-us_topic_0000001125023832_b577174975016"></a>-1</strong>: debug</li><li><strong id="en-us_topic_0000001125023832_b10557185012502"><a name="en-us_topic_0000001125023832_b10557185012502"></a><a name="en-us_topic_0000001125023832_b10557185012502"></a>0</strong>: info</li><li><strong id="en-us_topic_0000001125023832_b19731452115019"><a name="en-us_topic_0000001125023832_b19731452115019"></a><a name="en-us_topic_0000001125023832_b19731452115019"></a>1</strong>: warning</li><li><strong id="en-us_topic_0000001125023832_b96497538503"><a name="en-us_topic_0000001125023832_b96497538503"></a><a name="en-us_topic_0000001125023832_b96497538503"></a>2</strong>: error</li><li><strong id="en-us_topic_0000001125023832_b9427145555012"><a name="en-us_topic_0000001125023832_b9427145555012"></a><a name="en-us_topic_0000001125023832_b9427145555012"></a>3</strong>: dpanic</li><li><strong id="en-us_topic_0000001125023832_b142311571508"><a name="en-us_topic_0000001125023832_b142311571508"></a><a name="en-us_topic_0000001125023832_b142311571508"></a>4</strong>: panic</li><li><strong id="en-us_topic_0000001125023832_b157577587501"><a name="en-us_topic_0000001125023832_b157577587501"></a><a name="en-us_topic_0000001125023832_b157577587501"></a>5</strong>: fatal</li></ul>
    </td>
    </tr>
    <tr id="en-us_topic_0000001125023832_row12828338105911"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.2.5.1.1 "><p id="en-us_topic_0000001125023832_p962414206374"><a name="en-us_topic_0000001125023832_p962414206374"></a><a name="en-us_topic_0000001125023832_p962414206374"></a>-maxAge</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.2 "><p id="en-us_topic_0000001125023832_p196241420153715"><a name="en-us_topic_0000001125023832_p196241420153715"></a><a name="en-us_topic_0000001125023832_p196241420153715"></a>int</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.3 "><p id="en-us_topic_0000001125023832_p5624720113715"><a name="en-us_topic_0000001125023832_p5624720113715"></a><a name="en-us_topic_0000001125023832_p5624720113715"></a>7</p>
    </td>
    <td class="cellrowborder" valign="top" width="45%" headers="mcps1.2.5.1.4 "><p id="en-us_topic_0000001125023832_p2062492033716"><a name="en-us_topic_0000001125023832_p2062492033716"></a><a name="en-us_topic_0000001125023832_p2062492033716"></a>Log backup time limit. The minimum value is 7, in days.</p>
    </td>
    </tr>
    <tr id="en-us_topic_0000001125023832_row19827193825914"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.2.5.1.1 "><p id="en-us_topic_0000001125023832_p8601162318374"><a name="en-us_topic_0000001125023832_p8601162318374"></a><a name="en-us_topic_0000001125023832_p8601162318374"></a>-isCompress</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.2 "><p id="en-us_topic_0000001125023832_p360112233376"><a name="en-us_topic_0000001125023832_p360112233376"></a><a name="en-us_topic_0000001125023832_p360112233376"></a>bool</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.3 "><p id="en-us_topic_0000001125023832_p36029231378"><a name="en-us_topic_0000001125023832_p36029231378"></a><a name="en-us_topic_0000001125023832_p36029231378"></a>false</p>
    </td>
    <td class="cellrowborder" valign="top" width="45%" headers="mcps1.2.5.1.4 "><p id="en-us_topic_0000001125023832_p1602102311375"><a name="en-us_topic_0000001125023832_p1602102311375"></a><a name="en-us_topic_0000001125023832_p1602102311375"></a>Whether to automatically compress backup log files</p>
    </td>
    </tr>
    <tr id="en-us_topic_0000001125023832_row282710388595"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.2.5.1.1 "><p id="en-us_topic_0000001125023832_p172501226103710"><a name="en-us_topic_0000001125023832_p172501226103710"></a><a name="en-us_topic_0000001125023832_p172501226103710"></a>-logFile</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.2 "><p id="en-us_topic_0000001125023832_p13250626193718"><a name="en-us_topic_0000001125023832_p13250626193718"></a><a name="en-us_topic_0000001125023832_p13250626193718"></a>string</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.3 "><p id="en-us_topic_0000001125023832_p225052653711"><a name="en-us_topic_0000001125023832_p225052653711"></a><a name="en-us_topic_0000001125023832_p225052653711"></a>/var/log/mindx-dl/devicePlugin/devicePlugin.log</p>
    </td>
    <td class="cellrowborder" valign="top" width="45%" headers="mcps1.2.5.1.4 "><p id="en-us_topic_0000001125023832_p1525042673718"><a name="en-us_topic_0000001125023832_p1525042673718"></a><a name="en-us_topic_0000001125023832_p1525042673718"></a>Log file</p>
    <div class="note" id="en-us_topic_0000001125023832_note82654194514"><a name="en-us_topic_0000001125023832_note82654194514"></a><a name="en-us_topic_0000001125023832_note82654194514"></a><span class="notetitle"> NOTE: </span><div class="notebody"><p id="en-us_topic_0000001125023832_p13265151916514"><a name="en-us_topic_0000001125023832_p13265151916514"></a><a name="en-us_topic_0000001125023832_p13265151916514"></a>If the size of a log file exceeds 20 MB, automatic dump is triggered. The maximum size of a log file cannot be changed.</p>
    </div></div>
    </td>
    </tr>
    <tr id="en-us_topic_0000001125023832_row15827113819595"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.2.5.1.1 "><p id="en-us_topic_0000001125023832_p12517346377"><a name="en-us_topic_0000001125023832_p12517346377"></a><a name="en-us_topic_0000001125023832_p12517346377"></a>-maxBackups</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.2 "><p id="en-us_topic_0000001125023832_p225133416374"><a name="en-us_topic_0000001125023832_p225133416374"></a><a name="en-us_topic_0000001125023832_p225133416374"></a>int</p>
    </td>
    <td class="cellrowborder" valign="top" width="15%" headers="mcps1.2.5.1.3 "><p id="en-us_topic_0000001125023832_p18251173413378"><a name="en-us_topic_0000001125023832_p18251173413378"></a><a name="en-us_topic_0000001125023832_p18251173413378"></a>30</p>
    </td>
    <td class="cellrowborder" valign="top" width="45%" headers="mcps1.2.5.1.4 "><p id="en-us_topic_0000001125023832_p225183419372"><a name="en-us_topic_0000001125023832_p225183419372"></a><a name="en-us_topic_0000001125023832_p225183419372"></a>Maximum number of dumped log files that can be retained. The value range is (0, 30].</p>
    </td>
    </tr>
    </tbody>
    </table>
    
9. Run the following command to view the node device deployment information:

   ```
   kubectl describe node
   ```

   If the label and number of nodes are correct, the deployment is successful, as shown in the following figure.

   ```
   Capacity:
     cpu:                   128
     ephemeral-storage:     3842380928Ki
     huawei.com/Ascend910:  8
     hugepages-2Mi:         0
     memory:                263865068Ki
     pods:                  110
   Allocatable:
     cpu:                   128
     ephemeral-storage:     3541138257382
     huawei.com/Ascend910:  8
     hugepages-2Mi:         0
     memory:                263762668Ki
     pods:                  110
   ```


<h2 id="creating-a-service-container.md">Creating a Service Container</h2>

## Procedure<a name="en-us_topic_0269670251_section28051148174119"></a>

1.  <a name="en-us_topic_0269670251_en-us_topic_0249483204_li104071617503"></a>Go to the  **ascend-device-plugin**  directory and run the following command to edit the pod configuration file:

    ```
    cd /home/ascend-device-plugin
    vi ascend.yaml
    ```

    ```
    apiVersion: v1 #Specifies the API version. This value must be included in kubectl apiversion.
    kind: Pod #Role or type of the resource to be created
    metadata:
      name: rest502 #Pod name, which must be unique in the same namespace.
    spec:  #Detailed definition of a container in a pod.
      containers: #Containers in the pod.
      - name: rest502 #Container name in the pod.
        image: centos_arm64_resnet50:7.8 #Address of the inference or training service image used by the container in the pod.
        imagePullPolicy: Never
        resources:
          limits: #Resource limits
            huawei.com/Ascend310: 2 #Change the resource type based on the site requirements. For details about supported resource types, see the following section.
        volumeMounts:
          - name: joblog
            mountPath: /home/log/ #Path of the container internal log. Change the value based on the task requirements.
          - name: model
            mountPath: /home/app/model #Container internal model path. Change the value based on the task requirements.
          - name: slog-path
            mountPath: /var/log/npu/conf/slog/slog.conf
          - name: ascend-driver-path
            mountPath: /usr/local/Ascend/driver #Change the value based on the actual driver path.
      volumes:
        - name: joblog
          hostPath:
            path: /home/test/docker_log    #Log path mounted to the host. Change the value based on the task requirements.
        - name: model
          hostPath:
            path: /home/test/docker_model/  #Model path mounted to the host. Change the value based on the task requirements.
        - name: slog-path
          hostPath:
            path: /var/log/npu/conf/slog/slog.conf  
        - name: ascend-driver-path
          hostPath:
            path: /usr/local/Ascend/driver #Change the value based on the actual driver path.
    ```

    Supported resource types:

    -   **huawei.com/Ascend310: 2**, indicating that two  Ascend 310 AI Processors are allocated
    -   **huawei.com/Ascend710: 1**, indicating that one Ascend 710 AI Processor is allocated
    -   **huawei.com/Ascend910: 4**, indicating that four  Ascend 910 AI Processors are allocated
    -   **huawei.com/Ascend910-16c: 1**, indicating that a virtual device with 16 cores is allocated. Only single-card single-container tasks are supported. That is, the value must be  **1**. Virtual devices with  **2c**,  **4c**,  **8c**, or  **16c**  AI cores can be scheduled.

2.  Run the following command to create a pod:

    ```
    kubectl apply -f ascend.yaml
    ```

    >![](figures/icon-note.gif) **NOTE:** 
    >To delete the pod, run the following command:
    >**kubectl delete -f** **ascend.yaml**

3.  Run the following commands to access the pod and view the allocation information:

    ```
    kubectl exec -it Pod name bash
    ```

    The pod name is the one configured in  [1](#en-us_topic_0269670251_en-us_topic_0249483204_li104071617503).

    ```
    ls /dev/
    ```

    In the command output similar to the following,  **davinci3**  and  **davinci4**  are the allocated pods.

    ```
    core davinci3 davinci4 davinci_manager devmm_svm fd full hisi_hdc mqueue null ptmx
    ```


<h2 id="directory-structure.md">Directory Structure</h2>

```
├── build                                             # Compilation scripts
│   └── build.sh
├── output                                           # Compilation result directory.
├── src                                              # Source code directory.
│   └── plugin
│   │    ├── cmd/ascendplugin
│   │    │   └── ascend_plugin.go    
│   │    └── pkg/npu/huawei
├── test                                             # Test directory.
├── Dockerfile                                       # Image file.
├── LICENSE                                          
├── Open Source Software Notice.md                   
├── README.ZH.md
├── README.EN.md
├── ascend.yaml                                      # YAML file of the sample running task 
├── ascendplugin-310.yaml                            # YAML file for deploying the plugin on the inference card with Ascend 310
├── ascendplugin-710.yaml                            # YAML file for deploying the plugin on the inference card with Ascend 710
├── ascendplugin-volcano.yaml                        # YAML file for implementing affinity scheduling and deployment with Ascend 910 and Volcano
├── ascendplugin-910.yaml                            # YAML file for deploying the plugin with Ascend 910 but without Volcano
├── go.mod                                           
└── go.sum                                           
```

<h2 id="version-updates.md">Version Updates</h2>

<a name="table7854542104414"></a>
<table><thead align="left"><tr id="en-us_topic_0280467800_row785512423445"><th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.1.4.1.1"><p id="en-us_topic_0280467800_p19856144274419"><a name="en-us_topic_0280467800_p19856144274419"></a><a name="en-us_topic_0280467800_p19856144274419"></a>Version</p>
</th>
<th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.1.4.1.2"><p id="en-us_topic_0280467800_p3856134219446"><a name="en-us_topic_0280467800_p3856134219446"></a><a name="en-us_topic_0280467800_p3856134219446"></a>Date</p>
</th>
<th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.1.4.1.3"><p id="en-us_topic_0280467800_p585634218445"><a name="en-us_topic_0280467800_p585634218445"></a><a name="en-us_topic_0280467800_p585634218445"></a>Description</p>
</th>
</tr>
</thead>
<tbody><tr id="row7293189122012"><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.1 "><p id="p9235101416201"><a name="p9235101416201"></a><a name="p9235101416201"></a>v2.0.2</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.2 "><p id="p1523518145208"><a name="p1523518145208"></a><a name="p1523518145208"></a>2021-07-15</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.3 "><a name="ul162558202525"></a><a name="ul162558202525"></a><ul id="ul162558202525"><li>Added the support of Ascend 910 AI Processors for computing power splitting.</li></ul>
</td>
</tr>
<tr id="row13392135841913"><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.1 "><p id="p14450752204"><a name="p14450752204"></a><a name="p14450752204"></a>v2.0.1</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.2 "><p id="p1445019582013"><a name="p1445019582013"></a><a name="p1445019582013"></a>2021-04-20</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.3 "><a name="ul194113318201"></a><a name="ul194113318201"></a><ul id="ul194113318201"><li>Adapted to Ascend 710 AI Processors.</li><li>Changed the processor ID in the reported information from the logical ID to the physical ID.</li><li>Changed the policy to ensure that processors are not isolated due to minor alarms.</li></ul>
</td>
</tr>
<tr id="row137501013384"><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.1 "><p id="p137501613585"><a name="p137501613585"></a><a name="p137501613585"></a>v20.2.0</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.2 "><p id="p1675010135811"><a name="p1675010135811"></a><a name="p1675010135811"></a>2021-01-08</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.3 "><p id="p3750813889"><a name="p3750813889"></a><a name="p3750813889"></a>Optimized the description in "Creating DaemonSet."</p>
</td>
</tr>
<tr id="en-us_topic_0280467800_row118567425441"><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.1 "><p id="en-us_topic_0280467800_p08571442174415"><a name="en-us_topic_0280467800_p08571442174415"></a><a name="en-us_topic_0280467800_p08571442174415"></a>v20.2.0</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.2 "><p id="en-us_topic_0280467800_p38571542154414"><a name="en-us_topic_0280467800_p38571542154414"></a><a name="en-us_topic_0280467800_p38571542154414"></a>2020-11-18</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.3 "><p id="en-us_topic_0280467800_p5857142154415"><a name="en-us_topic_0280467800_p5857142154415"></a><a name="en-us_topic_0280467800_p5857142154415"></a>This is the first official release.</p>
</td>
</tr>
</tbody>
</table>

